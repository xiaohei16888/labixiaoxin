<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>蜡笔小新礼品卡系统</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          animation: {
            marquee: 'marquee 10s linear infinite',
            gradient: 'gradient 6s ease infinite',
          },
          keyframes: {
            marquee: {
              '0%': { transform: 'translateX(100%)' },
              '100%': { transform: 'translateX(-100%)' },
            },
            gradient: {
              '0%, 100%': { 'background-position': '0% 50%' },
              '50%': { 'background-position': '100% 50%' },
            },
          },
          backgroundSize: {
            'gradient': '200% 200%',
          }
        }
      }
    }
  </script>
</head>
<body class="bg-gray-100 text-gray-800">
  <div id="loginPage" class="min-h-screen flex flex-col items-center justify-center">
    <h1 class="text-3xl font-bold mb-4">蜡笔小新平台登录</h1>
    <input id="username" type="text" placeholder="用户名" class="mb-2 px-4 py-2 border rounded w-64" />
    <input id="password" type="password" placeholder="密码" class="mb-4 px-4 py-2 border rounded w-64" />
    <button onclick="login()" class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700">登录</button>
    <p id="loginError" class="text-red-600 mt-4 hidden">用户名或密码错误</p>
  </div>

  <div id="mainApp" class="hidden px-4 py-10">
    <div class="overflow-hidden w-full mb-4">
      <div class="whitespace-nowrap animate-marquee text-3xl font-bold text-center bg-gradient-to-r from-pink-500 via-yellow-500 to-purple-500 bg-clip-text text-transparent animate-gradient">
        蜡笔小新礼品卡系统
      </div>
    </div>
    <div class="flex items-center justify-between max-w-5xl mx-auto mb-6">
      <span id="balanceAmount" class="text-lg font-semibold text-green-700">当前余额：¥0.00 元</span>
      <button onclick="recharge(10)" class="bg-yellow-400 hover:bg-yellow-500 text-black px-4 py-2 rounded">模拟充值 +10 元</button>
      <button onclick="logout()" class="bg-gray-300 px-4 py-2 rounded hover:bg-gray-400">退出登录</button>
    </div>

    <div class="max-w-5xl mx-auto bg-white rounded shadow-md p-6 mb-10">
      <div class="flex items-center mb-4">
        <img src="https://upload.wikimedia.org/wikipedia/commons/a/a6/Logo_NIKE.svg" alt="Nike Logo" class="h-8 mr-3">
        <h2 class="text-2xl font-bold text-blue-600">Nike 批量查询</h2>
      </div>
      <label for="nikeInput" class="inline-block mb-4 bg-blue-600 text-white px-6 py-2 rounded cursor-pointer hover:bg-blue-700">选择 Nike Excel 文件</label>
      <input type="file" id="nikeInput" accept=".xlsx" style="display: none;" />
      <div id="nikeOutput" class="hidden mt-4">
        <table class="min-w-full border mb-4">
          <thead class="bg-gray-200 text-left">
            <tr><th class="border px-4 py-2">卡号</th><th class="border px-4 py-2">PIN</th><th class="border px-4 py-2">模拟余额</th></tr>
          </thead>
          <tbody id="nikeTableBody"></tbody>
        </table>
        <button onclick="exportNike()" class="bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700">导出 Nike 查询结果</button>
      </div>
    </div>

    <div class="max-w-5xl mx-auto bg-white rounded shadow-md p-6">
      <div class="flex items-center mb-4">
        <img src="https://upload.wikimedia.org/wikipedia/commons/9/9a/Target_logo.svg" alt="Target Logo" class="h-8 mr-3">
        <h2 class="text-2xl font-bold text-red-600">Target 批量查询</h2>
      </div>
      <label for="targetInput" class="inline-block mb-4 bg-red-600 text-white px-6 py-2 rounded cursor-pointer hover:bg-red-700">选择 Target Excel 文件</label>
      <input type="file" id="targetInput" accept=".xlsx" style="display: none;" />
      <div id="targetOutput" class="hidden mt-4">
        <table class="min-w-full border mb-4">
          <thead class="bg-gray-200 text-left">
            <tr><th class="border px-4 py-2">卡号</th><th class="border px-4 py-2">PIN</th><th class="border px-4 py-2">模拟余额</th></tr>
          </thead>
          <tbody id="targetTableBody"></tbody>
        </table>
        <button onclick="exportTarget()" class="bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700">导出 Target 查询结果</button>
      </div>
    </div>
  </div>

  <script>
    const users = [
      { username: 'test1', password: '123456' },
      { username: 'test2', password: '123456' },
      { username: 'test3', password: '123456' },
      { username: 'test4', password: '123456' },
      { username: 'test5', password: '123456' },
    ];

    let balance = 0;

    function login() {
      const user = document.getElementById('username').value;
      const pass = document.getElementById('password').value;
      const valid = users.some(u => u.username === user && u.password === pass);
      if (valid) {
        localStorage.setItem('login', 'yes');
        document.getElementById('loginPage').classList.add('hidden');
        document.getElementById('mainApp').classList.remove('hidden');
        updateBalanceUI();
      } else {
        document.getElementById('loginError').classList.remove('hidden');
      }
    }

    function logout() {
      localStorage.removeItem('login');
      location.reload();
    }

    window.onload = () => {
      if (localStorage.getItem('login') === 'yes') {
        document.getElementById('loginPage').classList.add('hidden');
        document.getElementById('mainApp').classList.remove('hidden');
        updateBalanceUI();
      }
    };

    const nikeData = [["卡号", "PIN", "模拟余额"]];
    const targetData = [["卡号", "PIN", "模拟余额"]];

    document.getElementById('nikeInput').addEventListener('change', function(e) {
      handleUpload(e.target.files[0], 'nike');
    });

    document.getElementById('targetInput').addEventListener('change', function(e) {
      handleUpload(e.target.files[0], 'target');
    });

    function handleUpload(file, brand) {
      const reader = new FileReader();
      reader.onload = function(e) {
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, { type: 'array' });
        const sheet = workbook.Sheets[workbook.SheetNames[0]];
        const rows = XLSX.utils.sheet_to_json(sheet, { header: 1 });
        if (rows.length < 2) return;

        const rowsToQuery = rows.slice(1).filter(row => row[0] && row[1]);
        const cost = rowsToQuery.length * 0.9;
        if (balance < cost) {
          alert(`余额不足，当前余额 ¥${balance.toFixed(2)}，需要 ¥${cost.toFixed(2)} 才能查询`);
          return;
        }

        balance -= cost;
        updateBalanceUI();

        const body = document.getElementById(brand + "TableBody");
        body.innerHTML = "";
        const outDiv = document.getElementById(brand + "Output");
        outDiv.classList.remove("hidden");

        const store = brand === "nike" ? nikeData : targetData;
        store.length = 1;

        rowsToQuery.forEach(row => {
          const card = row[0].toString().trim();
          const pin = row[1].toString().trim();
          const balanceValue = brand === "nike"
            ? `$${Math.floor(Math.random() * 400 + 50)}`
            : `$${Math.floor(Math.random() * 300 + 20)}`;
          store.push([card, pin, balanceValue]);

          const tr = document.createElement("tr");
          [card, pin, balanceValue].forEach(text => {
            const td = document.createElement("td");
            td.className = "border px-4 py-2";
            td.innerText = text;
            tr.appendChild(td);
          });
          body.appendChild(tr);
        });
      };
      reader.readAsArrayBuffer(file);
    }

    function exportNike() {
      const ws = XLSX.utils.aoa_to_sheet(nikeData);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "Nike查询结果");
      XLSX.writeFile(wb, "Nike_导出结果.xlsx");
    }

    function exportTarget() {
      const ws = XLSX.utils.aoa_to_sheet(targetData);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "Target查询结果");
      XLSX.writeFile(wb, "Target_导出结果.xlsx");
    }

    function recharge(amount) {
      balance += amount;
      updateBalanceUI();
    }

    function updateBalanceUI() {
      const el = document.getElementById("balanceAmount");
      if (el) el.innerText = `当前余额：¥${balance.toFixed(2)} 元`;
    }
  </script>
</body>
</html>

